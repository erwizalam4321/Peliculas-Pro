<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peliculas Pro - Your Ultimate Destination for Free HD Movie Streaming</title>
    <!-- Favicon: Using an SVG emoji for efficiency and relevance -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom CSS for rainbow text in the header */
        .rainbow-text-header {
            background-image: linear-gradient(to right, violet, indigo, blue, green, yellow, orange, red);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        /* CSS untuk membuat header menjadi sticky */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50; /* Pastikan header berada di atas konten lain saat digulir */
        }
    </style>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Welcome to Peliculas Pro, the best free movie streaming platform online. Watch thousands of HD movies, from new releases to timeless classics, with no subscription required. Your ultimate source for unlimited entertainment.">
    <meta name="keywords" content="Peliculas Pro, free movies, watch movies online, HD streaming, latest movies, popular movies, no subscription, free entertainment, online cinema, movie streaming site">
    <link rel="canonical" href="https://peliculaspro.netlify.app/">

    <!-- Open Graph & Twitter Meta Tags for social media sharing -->
    <meta property="og:title" content="Peliculas Pro - Free HD Movie Streaming">
    <meta property="og:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">
    <meta property="og:image" content="https://live.staticflickr.com/65535/54698621370_1b976fbd76_b.jpg">
    <meta property="og:url" content="https://peliculaspro.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="fb:app_id" content="100074345305108">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="@ErwizalA84074">
    <meta property="twitter:title" content="Peliculas Pro - Free HD Movie Streaming">
    <meta property="twitter:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">

</head>
<body class="bg-gray-900 text-gray-200">
    <!-- Header and Navigation -->
    <!-- Menambahkan class 'sticky-header' untuk membuat header tetap di atas saat scroll -->
    <header class="bg-gray-800 shadow-md sticky-header">
        <!-- New container to match the width of the main content -->
        <div class="container mx-auto px-4 max-w-7xl">
            <nav class="p-4 flex flex-col md:flex-row justify-between items-center">
                <a href="#" id="home-link" class="flex items-center mb-4 md:mb-0">
                    <!-- Movie Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400 mr-3" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                    </svg>
                    <span class="rainbow-text-header text-3xl md:text-4xl">Peliculas Pro</span>
                </a>
                <!-- Navigation links, dropdowns, and search bar -->
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-white hover:text-red-500 hover:font-bold transition-colors duration-300">Home</a>
                    <div class="relative group">
                        <button id="movies-dropdown-button" class="text-white hover:text-blue-500 hover:font-bold transition-colors duration-300 flex items-center">
                            Movies
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="movies-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="movie">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="now_playing" data-type="movie">Now Playing</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="upcoming" data-type="movie">Upcoming</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="movie">Top Rated</button>
                        </div>
                    </div>
                    <div class="relative group">
                        <button id="tv-shows-dropdown-button" class="text-white hover:text-yellow-400 transition-colors duration-300 flex items-center">
                            Tv Shows
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="tv-shows-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="tv">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="airing_today" data-type="tv">Airing Today</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="on_the_air" data-type="tv">On TV</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="tv">Top Rated</button>
                        </div>
                    </div>
                    <!-- Search Form -->
                    <form id="search-form" class="flex items-center">
                        <input type="text" id="search-input" placeholder="Search movies or TV shows..." class="px-3 py-1 text-sm rounded-l-full bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-40 md:w-auto">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-r-full shadow-lg transition-colors duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </button>
                    </form>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Main Banner Image -->
        <div id="hero-section" class="mb-8 rounded-lg overflow-hidden shadow-lg">
            <img src="https://live.staticflickr.com/65535/54698621370_1b976fbd76_b.jpg" alt="Peliculas Pro Movie Streaming Banner" class="w-full h-auto">
        </div>

        <!-- Main Heading -->
        <h1 id="main-heading" class="text-3xl md:text-4xl font-extrabold text-white mb-6 leading-tight flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
            </svg>
            Welcome to Peliculas Pro: Your Ultimate Destination for the Best Free Movie Streaming
        </h1>

        <!-- Introduction Section -->
        <p id="intro-section" class="text-lg mb-8 text-gray-300 text-justify">
            Welcome to Peliculas Pro, a revolutionary platform designed specifically for cinema lovers seeking a high-quality movie watching experience at no cost. In today's digital age, where entertainment is an inseparable part of daily life, Peliculas Pro serves as an advanced solution to meet your needs. We understand how valuable your free time is, and we are committed to providing unlimited access to thousands of films across various genres, from the latest Hollywood blockbusters to timeless classics. With a constantly updated collection and a user-friendly interface, Peliculas Pro is not just a streaming site but a community for those passionate about the seventh art.
        </p>
        
        <!-- Placeholder for dynamic content -->
        <div id="content-area"></div>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-center text-gray-400 p-4 mt-12">
        <p>&copy; 2024 Peliculas Pro. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // #############################################
            // API KEY CONFIGURATION (UPDATED)
            // #############################################
            // A list of available API keys/proxies. The application will try the first one,
            // and if it fails, it will fall back to the next one.
            const apiKeys = [
                'tmdb-api-proxy.argoyuwono119.workers.dev',
                'tmdb-api-proxy.musadekakhmad.workers.dev',
                'tmdb-api-proxy-1.musadekakhmad.workers.dev'
            ];
            
            // #############################################
            // CENTRALIZED STATE MANAGEMENT
            // #############################################

            const contentArea = document.getElementById('content-area');
            const heroSection = document.getElementById('hero-section');
            const introSection = document.getElementById('intro-section');
            const mainHeading = document.getElementById('main-heading');
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const homeLink = document.getElementById('home-link');

            const state = {
                currentPage: 1,
                renderedItemIds: new Set(),
                currentView: 'home', // 'home', 'list', 'details', 'search'
                listParams: null, // { fetchType, type, id, title }
                detailsParams: null, // { type, id, title }
                searchQuery: null,
            };

            const updateState = (newState) => {
                Object.assign(state, newState);
                render();
            };

            const render = () => {
                heroSection.classList.add('hidden');
                introSection.classList.add('hidden');
                mainHeading.classList.add('hidden');
                contentArea.innerHTML = '';
                
                state.renderedItemIds.clear();

                switch (state.currentView) {
                    case 'home':
                        heroSection.classList.remove('hidden');
                        introSection.classList.remove('hidden');
                        mainHeading.classList.remove('hidden');
                        mainHeading.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                            </svg>
                            Welcome to Peliculas Pro: Your Ultimate Destination for the Best Free Movie Streaming
                        `;
                        break;
                    case 'list':
                        showDynamicContent(state.listParams.fetchType, state.listParams.type, state.listParams.id, state.listParams.title);
                        break;
                    case 'details':
                        showDetails(state.detailsParams.type, state.detailsParams.id, state.detailsParams.title);
                        break;
                    case 'search':
                        showSearchResults(state.searchQuery);
                        break;
                }
            };
            
            // #############################################
            // UTILITY FUNCTIONS & API CALLS
            // #############################################
            // Function to perform a fetch with fallback if an API key fails
            const safeFetch = async (urlSuffix, options = {}) => {
                for (const apiKey of apiKeys) {
                    const url = `https://${apiKey}${urlSuffix}`;
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response.json();
                        }
                    } catch (error) {
                        console.warn(`Failed to fetch from ${apiKey}. Trying next API key.`, error);
                    }
                }
                throw new Error('All API keys failed to fetch data.');
            };

            const fetchContent = async (type, category, page = 1) => {
                const urlSuffix = `/${type}/${category}?page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    return [];
                }
            };
            
            const fetchByGenre = async (type, genreId, page = 1) => {
                const urlSuffix = `/discover/${type}?with_genres=${genreId}&page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data by genre:', error);
                    return [];
                }
            };

            const fetchSearchResults = async (query) => {
                const urlSuffix = `/search/multi?query=${encodeURIComponent(query)}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching search results:', error);
                    return [];
                }
            };

            const renderCards = (items, container) => {
                items.forEach(item => {
                    const mediaType = item.media_type || (item.title ? 'movie' : 'tv');

                    if (state.renderedItemIds.has(item.id) || (mediaType !== 'movie' && mediaType !== 'tv')) {
                        return;
                    }
                    state.renderedItemIds.add(item.id);

                    const title = item.title || item.name;
                    const posterPath = item.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    const card = document.createElement('div');
                    card.className = 'bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 cursor-pointer';
                    card.innerHTML = `
                        <img src="${posterUrl}" alt="Poster for ${title}" class="w-full h-auto object-cover">
                        <div class="p-4">
                            <h4 class="text-xl font-bold text-white truncate">${title}</h4>
                            <p class="text-sm text-gray-400 mt-1">Rating: ${item.vote_average.toFixed(1)}</p>
                        </div>
                    `;

                    // Update the click handler to include the movie title in the hash
                    card.addEventListener('click', () => {
                        window.location.hash = `details/${mediaType}/${item.id}/${encodeURIComponent(title)}`;
                    });

                    container.appendChild(card);
                });
            };

            const showDynamicContent = async (fetchType, type, id, title) => {
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">${title}</h2>`;
                mainHeading.classList.remove('hidden');

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                
                let items;
                if (fetchType === 'category') {
                    items = await fetchContent(type, id, state.currentPage);
                } else if (fetchType === 'genre') {
                    items = await fetchByGenre(type, id, state.currentPage);
                }

                if (items && items.length > 0) {
                    contentArea.appendChild(itemsContainer);
                    renderCards(items, itemsContainer);

                    const loadMoreButton = document.createElement('button');
                    loadMoreButton.className = 'mt-8 mx-auto block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform duration-300 transform hover:scale-105';
                    loadMoreButton.textContent = 'Load More';
                    
                    loadMoreButton.addEventListener('click', async () => {
                        updateState({ currentPage: state.currentPage + 1 });
                        let moreItems;
                        if (fetchType === 'category') {
                            moreItems = await fetchContent(type, id, state.currentPage);
                        } else if (fetchType === 'genre') {
                            moreItems = await fetchByGenre(type, id, state.currentPage);
                        }

                        if (moreItems && moreItems.length > 0) {
                            renderCards(moreItems, itemsContainer);
                        } else {
                            loadMoreButton.textContent = 'No More Items';
                            loadMoreButton.disabled = true;
                        }
                    });

                    contentArea.appendChild(loadMoreButton);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No content found.</p>';
                }
            };
            
            const showSearchResults = async (query) => {
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Search Results for: "${decodeURIComponent(query)}"</h2>`;
                mainHeading.classList.remove('hidden');

                const searchResults = await fetchSearchResults(query);

                if (searchResults && searchResults.length > 0) {
                    const itemsContainer = document.createElement('div');
                    itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                    contentArea.appendChild(itemsContainer);
                    renderCards(searchResults, itemsContainer);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No results found for your search.</p>';
                }
            };

            const showDetails = async (type, id, titleFromHash) => {
                const loadingSpinner = document.createElement('div');
                loadingSpinner.className = 'flex justify-center items-center h-64';
                loadingSpinner.innerHTML = `
                    <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"></div>
                `;
                contentArea.appendChild(loadingSpinner);
                
                try {
                    const [details, videosData, creditsData, similarData, reviewsData] = await Promise.all([
                        safeFetch(`/${type}/${id}`),
                        safeFetch(`/${type}/${id}/videos`),
                        safeFetch(`/${type}/${id}/credits`),
                        safeFetch(`/${type}/${id}/similar`),
                        safeFetch(`/${type}/${id}/reviews`)
                    ]);

                    loadingSpinner.remove();

                    const backButton = document.createElement('button');
                    backButton.className = 'bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 mb-6';
                    backButton.innerHTML = '← Back';
                    backButton.addEventListener('click', () => history.back());
                    contentArea.appendChild(backButton);

                    const trailer = videosData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');
                    const director = creditsData.crew.find(member => member.job === 'Director');
                    const cast = creditsData.cast.slice(0, 5).map(actor => actor.name).join(', ');
                    const similarItems = similarData.results.slice(0, 6);
                    const reviews = reviewsData.results.slice(0, 5);

                    const detailContainer = document.createElement('div');
                    detailContainer.className = 'grid grid-cols-1 md:grid-cols-3 gap-8';

                    const posterPath = details.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    const originalTitle = (details.title || details.name) !== details.original_title ? details.original_title : '';

                    let genreLinks = '';
                    if (details.genres && details.genres.length > 0) {
                        genreLinks = details.genres.map(g => 
                            `<span class="genre-link cursor-pointer text-blue-400 hover:text-blue-200 hover:underline" data-genre-id="${g.id}" data-genre-name="${g.name}">${g.name}</span>`
                        ).join(', ');
                    } else {
                        genreLinks = 'N/A';
                    }

                    detailContainer.innerHTML = `
                        <div class="md:col-span-1">
                            <img src="${posterUrl}" alt="Poster for ${details.title || details.name}" class="rounded-lg shadow-xl w-full">
                        </div>
                        <div class="md:col-span-2">
                            <h1 class="text-5xl font-extrabold text-white mb-2">${details.title || details.name}</h1>
                            ${originalTitle ? `<p class="text-xl text-gray-400 italic mb-6">(${originalTitle})</p>` : ''}
                            <p class="text-lg text-gray-400 mb-6">${details.tagline || ''}</p>
                            
                            <h2 class="text-2xl font-bold text-yellow-400 mb-4">Film Details</h2>
                            <div class="text-gray-300 space-y-4 mb-6">
                                <!-- Detail for Overview -->
                                <div class="flex flex-col">
                                    <p class="flex items-center mb-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-2 2a2 2 0 11-4 0 2 2 0 014 0zm-4 0v1.5c0 .65.34 1.27.94 1.62m4.12-1.62v1.5c0 .65-.34 1.27-.94 1.62M11 20h1.5a1.5 1.5 0 000-3H11V20z" />
                                        </svg>
                                        <strong class="font-bold text-white">Overview:</strong>
                                    </p>
                                    <p class="ml-8 text-gray-300 text-justify">${details.overview || 'N/A'}</p>
                                </div>

                                <!-- Detail for Release Date -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h.01M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <strong class="font-bold text-white">Release Date:</strong> <span class="ml-2">${details.release_date || details.first_air_date || 'N/A'}</span>
                                </div>

                                <!-- Detail for Rating -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400 mr-2 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                    </svg>
                                    <strong class="font-bold text-white">Rating:</strong> <span class="ml-2">${details.vote_average.toFixed(1)} / 10 (${details.vote_count} votes)</span>
                                </div>

                                <!-- Detail for Genres -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h18M3 12h18M3 16h18M7 8v8M17 8v8" />
                                    </svg>
                                    <strong class="font-bold text-white">Genres:</strong> <span class="ml-2">${genreLinks}</span>
                                </div>

                                <!-- Detail for Director -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10.5a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.5 12a4.5 4.5 0 00-9 0c0 2.485 1.563 4.536 3.75 5.584V21h1.5v-3.416c2.187-1.048 3.75-3.099 3.75-5.584z" />
                                    </svg>
                                    <strong class="font-bold text-white">Director:</strong> <span class="ml-2">${director ? director.name : 'N/A'}</span>
                                </div>

                                <!-- Detail for Actors -->
                                <div class="flex flex-col">
                                    <p class="flex items-center mb-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm0-4c-.552 0-1-.448-1-1s.448-1 1-1 1 .448 1 1-.448 1-1 1z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 17h-1.5a1.5 1.5 0 00-1.5-1.5V21H6v-2.5a1.5 1.5 0 00-1.5-1.5H3V6a3 3 0 013-3h12a3 3 0 013 3v11z" />
                                    </svg>
                                    <strong class="font-bold text-white">Actors:</strong>
                                    </p>
                                    <p class="ml-8 text-gray-300">${cast || 'N/A'}</p>
                                </div>

                                <!-- Detail for Original Language -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5.7M9.363 4.463l-2.079 1.77A2.99 2.99 0 006 8.322V15.5c0 1.577.828 3.015 2.188 3.82L10 21.5h4l1.812-2.18c1.36-.805 2.188-2.243 2.188-3.82V8.322a2.99 2.99 0 00-.784-2.137l-2.08-1.77M11.999 4h.001" />
                                    </svg>
                                    <strong class="font-bold text-white">Original Language:</strong> <span class="ml-2">${details.original_language.toUpperCase() || 'N/A'}</span>
                                </div>

                                <!-- Detail for Homepage -->
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172A2 2 0 0012 8V6a2 2 0 10-4 0v2m4 4v2m2 4h4a2 2 0 002-2v-6m-4-2a2 2 0 01-2-2V4a2 2 0 114 0v4m-6 4h4m-2 2v4a2 2 0 104 0v-4" />
                                    </svg>
                                    <strong class="font-bold text-white">Homepage:</strong> <span class="ml-2"><a href="${details.homepage}" class="text-blue-400 hover:underline" target="_blank">${details.homepage || 'N/A'}</a></span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    contentArea.appendChild(detailContainer);
                    
                    document.querySelectorAll('.genre-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            const genreId = e.target.dataset.genreId;
                            const genreName = e.target.dataset.genreName;
                            window.location.hash = `genre/${type}/${genreId}/${encodeURIComponent(genreName)}`;
                        });
                    });

                    if (trailer) {
                        const trailerSection = document.createElement('div');
                        trailerSection.className = 'w-full mt-12 text-center';
                        trailerSection.innerHTML = `
                            <h3 class="text-3xl font-bold text-white mb-6">Trailer</h3>
                            <div class="relative mx-auto w-full max-w-4xl aspect-video rounded-lg overflow-hidden shadow-xl">
                                <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${trailer.key}" frameborder="0" allowfullscreen></iframe>
                            </div>
                        `;
                        contentArea.appendChild(trailerSection);
                    }

                    if (similarItems.length > 0) {
                        const similarSection = document.createElement('div');
                        similarSection.className = 'mt-12';
                        similarSection.innerHTML = `
                            <h4 class="text-3xl font-bold text-white mb-6">Similar Movies</h4>
                            <div id="similar-movies-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4"></div>
                        `;
                        contentArea.appendChild(similarSection);

                        const similarContainer = document.getElementById('similar-movies-container');
                        renderCards(similarItems, similarContainer);
                    }

                    if (reviews.length > 0) {
                        const reviewsSection = document.createElement('div');
                        reviewsSection.className = 'mt-12';
                        reviewsSection.innerHTML = `
                            <h4 class="text-3xl font-bold text-white mb-6">User Reviews</h4>
                            <div id="user-reviews-container" class="space-y-6"></div>
                        `;
                        contentArea.appendChild(reviewsSection);

                        const reviewsContainer = document.getElementById('user-reviews-container');
                        reviews.forEach(review => {
                            const reviewCard = document.createElement('div');
                            reviewCard.className = 'bg-gray-800 p-6 rounded-lg shadow-md';
                            reviewCard.innerHTML = `
                                <p class="text-lg font-bold text-yellow-400">By ${review.author}</p>
                                <p class="text-sm text-gray-400 mt-1">Created on: ${new Date(review.created_at).toLocaleDateString()}</p>
                                <p class="mt-4 text-justify line-clamp-3">${review.content}</p>
                                <button class="read-more-button mt-2 text-blue-400 hover:underline text-sm" data-full-content="${encodeURIComponent(review.content)}">Read More</button>
                            `;
                            reviewsContainer.appendChild(reviewCard);
                        });

                        document.querySelectorAll('.read-more-button').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const fullContent = decodeURIComponent(e.target.dataset.fullContent);
                                showModal(fullContent);
                            });
                        });

                    } else {
                        const noReviews = document.createElement('div');
                        noReviews.className = 'mt-12 text-center text-gray-500';
                        noReviews.innerHTML = '<p>No user reviews available for this film yet.</p>';
                        contentArea.appendChild(noReviews);
                    }

                    const showModal = (content) => {
                        const modalOverlay = document.createElement('div');
                        modalOverlay.id = 'modal-overlay';
                        modalOverlay.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
                        modalOverlay.innerHTML = `
                            <div class="bg-gray-800 p-8 rounded-lg shadow-xl max-w-2xl w-full mx-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-2xl font-bold text-white">Full Review</h4>
                                    <button id="close-modal" class="text-gray-400 hover:text-white">&times;</button>
                                </div>
                                <p class="text-gray-300 whitespace-pre-wrap">${content}</p>
                            </div>
                        `;
                        document.body.appendChild(modalOverlay);

                        document.getElementById('close-modal').addEventListener('click', () => {
                            modalOverlay.remove();
                        });
                        modalOverlay.addEventListener('click', (e) => {
                            if (e.target.id === 'modal-overlay') {
                                modalOverlay.remove();
                            }
                        });
                    };
                } catch (error) {
                    console.error("Failed to fetch movie details:", error);
                    loadingSpinner.remove();
                    contentArea.innerHTML = '<p class="text-center text-red-500">Error loading movie details. Please try again.</p>';
                }
            };
            
            // #############################################
            // ROUTING & EVENT LISTENERS
            // #############################################

            const handleUrlHash = () => {
                const hash = window.location.hash.slice(1);
                if (!hash) {
                    updateState({ currentView: 'home' });
                    return;
                }

                // Split the hash and decode the title
                const [view, type, id, ...titleParts] = hash.split('/');
                const title = decodeURIComponent(titleParts.join('/'));
                
                switch(view) {
                    case 'content':
                        updateState({
                            currentView: 'list',
                            listParams: { fetchType: 'category', type, id, title },
                            currentPage: 1
                        });
                        break;
                    case 'details':
                        updateState({
                            currentView: 'details',
                            detailsParams: { type, id, title }
                        });
                        break;
                    case 'genre':
                        updateState({
                            currentView: 'list',
                            listParams: { fetchType: 'genre', type, id, title: `Film Genre: ${title}` },
                            currentPage: 1
                        });
                        break;
                    case 'search':
                        updateState({
                            currentView: 'search',
                            searchQuery: type
                        });
                        break;
                    default:
                        updateState({ currentView: 'home' });
                        break;
                }
            };
            
            homeLink.addEventListener('click', () => {
                window.location.hash = '';
            });

            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value;
                if (query) {
                    window.location.hash = `search/${encodeURIComponent(query)}`;
                }
            });

            document.querySelectorAll('#movies-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Movies`;
                    window.location.hash = `content/${type}/${category}/${encodeURIComponent(title)}`;
                });
            });

            document.querySelectorAll('#tv-shows-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Tv Shows`;
                    window.location.hash = `content/${type}/${category}/${encodeURIComponent(title)}`;
                });
            });
            
            // Initial load based on hash
            if (!window.location.hash) {
                window.location.hash = 'content/movie/now_playing/Now%20Playing%20Movies';
            } else {
                handleUrlHash();
            }
            
            window.addEventListener('hashchange', handleUrlHash);
        });
    </script>
</body>
</html>
