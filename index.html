<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peliculas Pro - Your Ultimate Destination for Free HD Movie Streaming</title>
    <!-- Favicon: Using an SVG emoji for efficiency and relevance -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom CSS for rainbow text in the header */
        .rainbow-text-header {
            background-image: linear-gradient(to right, violet, indigo, blue, green, yellow, orange, red);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        /* CSS for making the header sticky */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50; /* Ensure the header stays on top of other content when scrolling */
        }
    </style>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Welcome to Peliculas Pro, the best free movie streaming platform online. Watch thousands of HD movies, from new releases to timeless classics, with no subscription required. Your ultimate source for unlimited entertainment.">
    <meta name="keywords" content="Peliculas Pro, free movies, watch movies online, HD streaming, latest movies, popular movies, no subscription, free entertainment, online cinema, movie streaming site">
    <link rel="canonical" href="https://peliculaspro.netlify.app/">

    <!-- Open Graph & Twitter Meta Tags for social media sharing -->
    <meta property="og:title" content="Peliculas Pro - Free HD Movie Streaming">
    <meta property="og:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">
    <meta property="og:image" content="https://live.staticflickr.com/65535/54698621370_1b976fbd76_b.jpg">
    <meta property="og:url" content="https://peliculaspro.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="fb:app_id" content="100074345305108">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="@ErwizalA84074">
    <meta property="twitter:title" content="Peliculas Pro - Free HD Movie Streaming">
    <meta property="twitter:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">

</head>
<body class="bg-gray-900 text-gray-200">
    <!-- Header and Navigation -->
    <!-- Add a 'sticky-header' class to make the header stick to the top on scroll -->
    <header class="bg-gray-800 shadow-md sticky-header">
        <!-- New container to match the width of the main content -->
        <div class="container mx-auto px-4 max-w-7xl">
            <nav class="p-4 flex flex-col md:flex-row justify-between items-center">
                <a href="#" id="home-link" class="flex items-center mb-4 md:mb-0">
                    <!-- Movie Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400 mr-3" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                    </svg>
                    <span class="rainbow-text-header text-3xl md:text-4xl">Peliculas Pro</span>
                </a>
                <!-- Navigation links, dropdowns, and search bar -->
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-white hover:text-red-500 hover:font-bold transition-colors duration-300">Home</a>
                    <div class="relative group">
                        <button id="movies-dropdown-button" class="text-white hover:text-blue-500 hover:font-bold transition-colors duration-300 flex items-center">
                            Movies
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="movies-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="movie">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="now_playing" data-type="movie">Now Playing</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="upcoming" data-type="movie">Upcoming</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="movie">Top Rated</button>
                        </div>
                    </div>
                    <div class="relative group">
                        <button id="tv-shows-dropdown-button" class="text-white hover:text-yellow-400 transition-colors duration-300 flex items-center">
                            Tv Shows
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="tv-shows-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="tv">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="airing_today" data-type="tv">Airing Today</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="on_the_air" data-type="tv">On TV</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="tv">Top Rated</button>
                        </div>
                    </div>
                    <!-- Search Form -->
                    <form id="search-form" class="flex items-center">
                        <input type="text" id="search-input" placeholder="Search movies or TV shows..." class="px-3 py-1 text-sm rounded-l-full bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-40 md:w-auto">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-r-full shadow-lg transition-colors duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </button>
                    </form>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Main Banner Image -->
        <div id="hero-section" class="mb-8 rounded-lg overflow-hidden shadow-lg">
            <img src="https://live.staticflickr.com/65535/54698621370_1b976fbd76_b.jpg" alt="Peliculas Pro Movie Streaming Banner" class="w-full h-auto">
        </div>

        <!-- Main Heading -->
        <h1 id="main-heading" class="text-3xl md:text-4xl font-extrabold text-white mb-6 leading-tight flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
            </svg>
            Welcome to Peliculas Pro: Your Ultimate Destination for the Best Free Movie Streaming
        </h1>

        <!-- Introduction Section -->
        <p id="intro-section" class="text-lg mb-8 text-gray-300 text-justify">
            Welcome to Peliculas Pro, a revolutionary platform designed specifically for cinema lovers seeking a high-quality movie watching experience at no cost. In today's digital age, where entertainment is an inseparable part of daily life, Peliculas Pro serves as an advanced solution to meet your needs. We understand how valuable your free time is, and we are committed to providing unlimited access to thousands of films across various genres, from the latest Hollywood blockbusters to timeless classics. With a constantly updated collection and a user-friendly interface, Peliculas Pro is not just a streaming site but a community for those passionate about the seventh art.
        </p>
        
        <!-- Placeholder for dynamic content -->
        <div id="content-area"></div>
    </main>

    <!-- Modal for Streaming Player -->
    <div id="streaming-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
        <!-- Main modal content container -->
        <div class="bg-gray-900 rounded-lg p-4 shadow-lg w-full max-w-7xl relative max-h-[90vh] overflow-y-auto">
            <button id="close-modal-button" class="absolute top-2 right-2 text-gray-400 hover:text-white text-3xl font-bold">&times;</button>
            <h3 id="streaming-modal-title" class="text-xl md:text-2xl font-bold text-white mb-4 text-center"></h3>
            <div class="relative w-full h-0 pb-[56.25%] rounded-lg overflow-hidden mb-4">
                <iframe id="streaming-player" class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="flex justify-center space-x-4">
                <button id="stream-1-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 shadow-lg">Stream 1</button>
                <button id="stream-2-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 shadow-lg">Stream 2</button>
            </div>
            <!-- Notification messages for the user -->
            <div class="mt-4 text-center text-sm text-gray-400 space-y-2">
                <p>Please wait for the player to display the film (maximum 1 minute).</p>
                <p>Film availability depends on the third party.</p>
                <p>Enjoy the show! Share this web link if you like it!</p>
            </div>
            <!-- New section for "Some people like this" - now horizontally scrollable -->
            <div class="mt-[0.7cm] text-center">
                <h4 class="text-lg font-bold text-white mb-4">Some people like this</h4>
                <!-- Use flexbox and overflow-x-auto for horizontal scrolling -->
                <div id="modal-similar-container" class="flex overflow-x-auto gap-4 p-2">
                    <!-- Film cards will be inserted here dynamically -->
                </div>
            </div>
        </div>
    </div>


    <!-- Footer Section -->
    <footer class="bg-gray-800 text-center text-gray-400 p-4 mt-12">
        <p>&copy; 2024 Peliculas Pro. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // #############################################
            // API KEY CONFIGURATION (UPDATED)
            // #############################################
            // A list of available API keys/proxies. The application will try the first one,
            // and if it fails, it will fall back to the next one.
            const apiKeys = [
                'tmdb-api-proxy.argoyuwono119.workers.dev',
                'tmdb-api-proxy.musadekakhmad.workers.dev',
                'tmdb-api-proxy-1.musadekakhmad.workers.dev'
            ];
            
            // #############################################
            // CENTRALIZED STATE MANAGEMENT
            // #############################################

            const contentArea = document.getElementById('content-area');
            const heroSection = document.getElementById('hero-section');
            const introSection = document.getElementById('intro-section');
            const mainHeading = document.getElementById('main-heading');
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const homeLink = document.getElementById('home-link');
            const streamingModal = document.getElementById('streaming-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const streamingPlayer = document.getElementById('streaming-player');
            const streamingModalTitle = document.getElementById('streaming-modal-title');
            const stream1Button = document.getElementById('stream-1-button');
            const stream2Button = document.getElementById('stream-2-button');
            const modalSimilarContainer = document.getElementById('modal-similar-container');

            const state = {
                currentPage: 1,
                renderedItemIds: new Set(),
                currentView: 'home', // 'home', 'list', 'details', 'search'
                listParams: null, // { fetchType, type, id, title }
                detailsParams: null, // { type, id, title }
                searchQuery: null,
                currentTrailerKey: null,
                currentMediaId: null, // Menyimpan ID media saat ini
                currentMediaType: null // Menyimpan tipe media saat ini
            };

            const updateState = (newState) => {
                Object.assign(state, newState);
                render();
            };

            const render = () => {
                heroSection.classList.add('hidden');
                introSection.classList.add('hidden');
                mainHeading.classList.add('hidden');
                contentArea.innerHTML = '';
                
                state.renderedItemIds.clear();

                switch (state.currentView) {
                    case 'home':
                        heroSection.classList.remove('hidden');
                        introSection.classList.remove('hidden');
                        mainHeading.classList.remove('hidden');
                        mainHeading.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                            </svg>
                            Welcome to Peliculas Pro: Your Ultimate Destination for the Best Free Movie Streaming
                        `;
                        break;
                    case 'list':
                        showDynamicContent(state.listParams.fetchType, state.listParams.type, state.listParams.id, state.listParams.title);
                        break;
                    case 'details':
                        showDetails(state.detailsParams.type, state.detailsParams.id, state.detailsParams.title);
                        break;
                    case 'search':
                        showSearchResults(state.searchQuery);
                        break;
                }
            };
            
            // #############################################
            // UTILITY FUNCTIONS & API CALLS
            // #############################################
            // Function to perform a fetch with fallback if an API key fails
            const safeFetch = async (urlSuffix, options = {}) => {
                for (const apiKey of apiKeys) {
                    const url = `https://${apiKey}${urlSuffix}`;
                    try {
                        const response = await fetch(url, options);
                        if (response.ok) {
                            return response.json();
                        }
                    } catch (error) {
                        console.warn(`Failed to fetch from ${apiKey}. Trying next API key.`, error);
                    }
                }
                throw new Error('All API keys failed to fetch data.');
            };

            const fetchContent = async (type, category, page = 1) => {
                const urlSuffix = `/${type}/${category}?page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    return [];
                }
            };
            
            const fetchByGenre = async (type, genreId, page = 1) => {
                const urlSuffix = `/discover/${type}?with_genres=${genreId}&page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data by genre:', error);
                    return [];
                }
            };

            const fetchSearchResults = async (query) => {
                const urlSuffix = `/search/multi?query=${encodeURIComponent(query)}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching search results:', error);
                    return [];
                }
            };

            const renderCards = (items, container, limit = null) => {
                const itemsToRender = limit ? items.slice(0, limit) : items;

                itemsToRender.forEach(item => {
                    const mediaType = item.media_type || (item.title ? 'movie' : 'tv');

                    if (state.renderedItemIds.has(item.id) || (mediaType !== 'movie' && mediaType !== 'tv')) {
                        return;
                    }
                    state.renderedItemIds.add(item.id);

                    const title = item.title || item.name;
                    const posterPath = item.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    const card = document.createElement('div');
                    card.className = 'bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 cursor-pointer';
                    card.innerHTML = `
                        <img src="${posterUrl}" alt="Poster for ${title}" class="w-full h-auto object-cover">
                        <div class="p-4">
                            <h4 class="text-xl font-bold text-white truncate">${title}</h4>
                            <p class="text-sm text-gray-400 mt-1">Rating: ${item.vote_average.toFixed(1)}</p>
                        </div>
                    `;

                    // Update the click handler to include the movie title in the hash
                    card.addEventListener('click', () => {
                        window.location.hash = `details/${mediaType}/${item.id}/${encodeURIComponent(title)}`;
                    });

                    container.appendChild(card);
                });
            };

            const renderSimpleCards = (items, container, limit = null) => {
                const itemsToRender = limit ? items.slice(0, limit) : items;
                container.innerHTML = ''; // Clear previous content

                itemsToRender.forEach(item => {
                    const mediaType = item.media_type || (item.title ? 'movie' : 'tv');
                    const title = item.title || item.name;
                    const posterPath = item.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w200/${posterPath}` : 'https://placehold.co/200x300?text=No+Image';

                    const card = document.createElement('div');
                    // Add flex-shrink-0 to prevent cards from shrinking on small screens
                    card.className = 'bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 cursor-pointer w-[150px] flex-shrink-0';
                    card.innerHTML = `
                        <img src="${posterUrl}" alt="Poster for ${title}" class="w-full h-auto object-cover">
                        <div class="p-2">
                            <h4 class="text-sm font-bold text-white truncate">${title}</h4>
                        </div>
                    `;
                    card.addEventListener('click', () => {
                        window.location.hash = `details/${mediaType}/${item.id}/${encodeURIComponent(title)}`;
                        streamingModal.classList.remove('flex');
                        streamingModal.classList.add('hidden');
                        streamingPlayer.src = '';
                    });
                    container.appendChild(card);
                });
            };

            const showDynamicContent = async (fetchType, type, id, title) => {
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">${title}</h2>`;
                mainHeading.classList.remove('hidden');

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                
                let items;
                if (fetchType === 'category') {
                    items = await fetchContent(type, id, state.currentPage);
                } else if (fetchType === 'genre') {
                    items = await fetchByGenre(type, id, state.currentPage);
                }

                if (items && items.length > 0) {
                    contentArea.appendChild(itemsContainer);
                    renderCards(items, itemsContainer);

                    const loadMoreButton = document.createElement('button');
                    loadMoreButton.className = 'mt-8 mx-auto block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform duration-300 transform hover:scale-105';
                    loadMoreButton.textContent = 'Load More';
                    
                    loadMoreButton.addEventListener('click', async () => {
                        updateState({ currentPage: state.currentPage + 1 });
                        let moreItems;
                        if (fetchType === 'category') {
                            moreItems = await fetchContent(type, id, state.currentPage);
                        } else if (fetchType === 'genre') {
                            moreItems = await fetchByGenre(type, id, state.currentPage);
                        }
                        if (moreItems && moreItems.length > 0) {
                            renderCards(moreItems, itemsContainer);
                        } else {
                            loadMoreButton.textContent = 'No More Items';
                            loadMoreButton.disabled = true;
                        }
                    });
                    contentArea.appendChild(loadMoreButton);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No content found.</p>';
                }
            };

            const showSearchResults = async (query) => {
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Search Results for: "${decodeURIComponent(query)}"</h2>`;
                mainHeading.classList.remove('hidden');

                const searchResults = await fetchSearchResults(query);

                if (searchResults && searchResults.length > 0) {
                    const itemsContainer = document.createElement('div');
                    itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                    contentArea.appendChild(itemsContainer);
                    renderCards(searchResults, itemsContainer);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No results found for your search.</p>';
                }
            };

            const showDetails = async (type, id, titleFromHash) => {
                const loadingSpinner = document.createElement('div');
                loadingSpinner.className = 'flex justify-center items-center h-64';
                loadingSpinner.innerHTML = `
                    <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-blue-500"></div>
                `;
                contentArea.appendChild(loadingSpinner);

                try {
                    // Fetching all necessary data in parallel
                    const [details, videosData, creditsData, reviewsData, similarData] = await Promise.all([
                        safeFetch(`/${type}/${id}`),
                        safeFetch(`/${type}/${id}/videos`),
                        safeFetch(`/${type}/${id}/credits`),
                        safeFetch(`/${type}/${id}/reviews`),
                        safeFetch(`/${type}/${id}/similar`)
                    ]);

                    loadingSpinner.remove();

                    // Menyimpan ID dan tipe media ke dalam state global
                    state.currentMediaId = id;
                    state.currentMediaType = type;

                    const backButton = document.createElement('button');
                    backButton.className = 'bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 mb-6 flex items-center';
                    backButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        Back
                    `;
                    backButton.addEventListener('click', () => history.back());
                    contentArea.appendChild(backButton);

                    const director = creditsData.crew.find(member => member.job === 'Director');
                    const cast = creditsData.cast.slice(0, 5).map(actor => actor.name).join(', ');

                    const posterPath = details.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    let genreLinks = '';
                    if (details.genres && details.genres.length > 0) {
                        genreLinks = details.genres.map(g =>
                            `<span class="genre-link cursor-pointer text-blue-400 hover:text-blue-200 hover:underline" data-genre-id="${g.id}" data-genre-name="${g.name}">${g.name}</span>`
                        ).join(', ');
                    } else {
                        genreLinks = 'N/A';
                    }
                    
                    const trailer = videosData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');

                    // Menyiapkan HTML untuk tampilan detail
                    const detailContainer = document.createElement('div');
                    detailContainer.className = 'grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12';
                    detailContainer.innerHTML = `
                        <div class="md:col-span-1">
                            <img src="${posterUrl}" alt="Poster for ${details.title || details.name}" class="rounded-lg shadow-lg w-full">
                        </div>
                        <div class="md:col-span-2 space-y-4">
                            <h2 class="text-4xl font-extrabold text-white">${details.title || details.name}</h2>
                            <p class="text-xl italic text-gray-400">${details.tagline || ''}</p>

                            <h3 class="text-2xl font-bold text-white mt-8 mb-4">Film Details</h3>
                            <div class="text-lg text-gray-300 space-y-3">
                                <p class="flex items-start">
                                    <span class="mr-3 text-2xl">📜</span>
                                    <span>
                                        <strong class="text-white">Overview:</strong>
                                        <br>
                                        <span class="text-justify">${details.overview}</span>
                                    </span>
                                </p>
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">⭐</span>
                                    <strong class="text-white">Rating:</strong> ${details.vote_average.toFixed(1)}/10 (${details.vote_count} votes)
                                </p>
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">📅</span>
                                    <strong class="text-white">Release Date:</strong> ${details.release_date || details.first_air_date}
                                </p>
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🎭</span>
                                    <strong class="text-white">Genres:</strong> ${genreLinks}
                                </p>
                                ${director ? `
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🎬</span>
                                    <strong class="text-white">Director:</strong> ${director.name}
                                </p>` : ''}
                                ${cast ? `
                                <p class="flex items-start">
                                    <span class="mr-3 text-2xl">🎭</span>
                                    <span>
                                        <strong class="text-white">Actors:</strong>
                                        <br>
                                        ${cast}
                                    </span>
                                </p>` : ''}
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🌐</span>
                                    <strong class="text-white">Original Language:</strong> ${details.original_language.toUpperCase()}
                                </p>
                                ${details.homepage ? `
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🔗</span>
                                    <strong class="text-white">Homepage:</strong>
                                    <a href="${details.homepage}" target="_blank" class="text-blue-400 hover:text-blue-200 hover:underline ml-2">${details.homepage}</a>
                                </p>` : ''}
                            </div>
                        </div>
                    `;

                    contentArea.appendChild(detailContainer);

                    // Elemen trailer mandiri, diletakkan di bawah detail film
                    if (trailer) {
                        const trailerContainer = document.createElement('div');
                        trailerContainer.className = 'mt-12 mx-auto w-full md:w-4/5 lg:w-3/4';
                        trailerContainer.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-4 text-center">Trailer</h3>
                            <div class="relative w-full h-0 pb-[56.25%] rounded-lg overflow-hidden shadow-xl">
                                <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${trailer.key}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        `;
                        contentArea.appendChild(trailerContainer);
                    }

                    // Menambahkan bagian "Similar to this"
                    if (similarData && similarData.results && similarData.results.length > 0) {
                        const similarSection = document.createElement('div');
                        similarSection.className = 'mt-12';
                        similarSection.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-6 text-center">Similar to this</h3>
                            <div id="similar-movies-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4"></div>
                        `;
                        contentArea.appendChild(similarSection);
                        const similarMoviesContainer = document.getElementById('similar-movies-container');
                        // Render 6 film teratas yang serupa
                        renderCards(similarData.results.slice(0, 6), similarMoviesContainer);
                    }


                    // Menambahkan bagian "User Review"
                    if (reviewsData && reviewsData.results && reviewsData.results.length > 0) {
                        const reviewsSection = document.createElement('div');
                        reviewsSection.className = 'mt-12';
                        reviewsSection.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-6 text-center">User Reviews</h3>
                            <div id="reviews-container" class="space-y-6"></div>
                        `;
                        contentArea.appendChild(reviewsSection);
                        const reviewsContainer = document.getElementById('reviews-container');

                        // Render 5 ulasan teratas
                        reviewsData.results.slice(0, 5).forEach(review => {
                            const reviewCard = document.createElement('div');
                            reviewCard.className = 'bg-gray-800 rounded-lg shadow-lg p-6';
                            reviewCard.innerHTML = `
                                <div class="flex items-center mb-4">
                                    <div class="h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center text-white text-xl font-bold mr-4">
                                        ${review.author.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <p class="font-bold text-white">${review.author}</p>
                                        <p class="text-sm text-gray-400">Reviewed on: ${new Date(review.created_at).toLocaleDateString()}</p>
                                    </div>
                                </div>
                                <p class="text-gray-300 text-justify line-clamp-4">${review.content}</p>
                                <button onclick="this.parentNode.querySelector('.line-clamp-4').classList.toggle('line-clamp-4')" class="text-blue-400 hover:underline mt-2">Read More</button>
                            `;
                            reviewsContainer.appendChild(reviewCard);
                        });
                    } else {
                        const noReviews = document.createElement('p');
                        noReviews.className = 'mt-12 text-center text-gray-500';
                        noReviews.textContent = 'No user reviews available yet.';
                        contentArea.appendChild(noReviews);
                    }

                    // Menambahkan tombol "Stream Now" di bawah ulasan
                    const streamingNowContainer = document.createElement('div');
                    streamingNowContainer.className = 'mt-8 flex justify-center';
                    streamingNowContainer.innerHTML = `
                        <button id="streaming-now-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300 shadow-lg transform hover:scale-105">
                            Stream Now
                        </button>
                    `;
                    contentArea.appendChild(streamingNowContainer);


                    // Add event listeners for genre links
                    document.querySelectorAll('.genre-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const genreId = e.target.dataset.genreId;
                            const genreName = e.target.dataset.genreName;
                            // Update the URL hash to trigger the genre list view
                            window.location.hash = `content/${type}/genre/${genreId}/${encodeURIComponent(genreName)}`;
                        });
                    });

                    // Add event listener for the new "Streaming Now" button
                    const streamingNowButton = document.getElementById('streaming-now-button');
                    streamingNowButton.addEventListener('click', async () => {
                        streamingModalTitle.textContent = `Streaming: ${details.title || details.name}`;
                        streamingModal.classList.remove('hidden');
                        streamingModal.classList.add('flex');
                        
                        // Secara otomatis memuat stream pertama saat modal dibuka
                        if (state.currentMediaId) {
                            streamingPlayer.src = `https://vidsrc.me/embed/${state.currentMediaId}`;
                        }

                        // Memuat film-film serupa (genre romantis) di dalam modal
                        const romanceMovies = await fetchByGenre('movie', 10749, 1);
                        if (romanceMovies && romanceMovies.length > 0) {
                            renderSimpleCards(romanceMovies.slice(0, 12), modalSimilarContainer);
                        }
                    });

                } catch (error) {
                    console.error('Failed to fetch details:', error);
                    loadingSpinner.remove();
                    contentArea.innerHTML = '<p class="text-center text-red-500">Failed to load details. Please try again.</p>';
                }
            };
            
            const handleUrlHash = () => {
                const hash = window.location.hash.slice(1);
                if (!hash) {
                    updateState({ currentView: 'home', listParams: null, detailsParams: null, searchQuery: null, currentPage: 1 });
                    return;
                }
                const parts = hash.split('/');
                const view = parts[0];

                switch (view) {
                    case 'content':
                        if (parts.length > 3) {
                            const [_, type, fetchType, id, title] = parts;
                            const titleDecoded = decodeURIComponent(title);
                            updateState({
                                currentView: 'list',
                                listParams: { fetchType, type, id, title: titleDecoded },
                                detailsParams: null,
                                searchQuery: null,
                                currentPage: 1
                            });
                        }
                        break;
                    case 'details':
                        if (parts.length > 3) {
                            const [_, type, id, title] = parts;
                            const titleDecoded = decodeURIComponent(title);
                            updateState({
                                currentView: 'details',
                                detailsParams: { type, id, title: titleDecoded },
                                listParams: null,
                                searchQuery: null
                            });
                        }
                        break;
                    case 'search':
                        if (parts.length > 1) {
                            const [_, query] = parts;
                            const queryDecoded = decodeURIComponent(query);
                            updateState({
                                currentView: 'search',
                                searchQuery: queryDecoded,
                                listParams: null,
                                detailsParams: null
                            });
                        }
                        break;
                    default:
                        updateState({ currentView: 'home', listParams: null, detailsParams: null, searchQuery: null });
                        break;
                }
            };

            // Event Listeners
            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    window.location.hash = `search/${encodeURIComponent(query)}`;
                }
            });

            document.querySelectorAll('#movies-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Movies`;
                    window.location.hash = `content/${type}/category/${category}/${encodeURIComponent(title)}`;
                });
            });

            document.querySelectorAll('#tv-shows-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Tv Shows`;
                    window.location.hash = `content/${type}/category/${category}/${encodeURIComponent(title)}`;
                });
            });
            
            // Initial load based on hash
            if (!window.location.hash || window.location.hash === '#home') {
                updateState({ currentView: 'home' });
            } else {
                handleUrlHash();
            }
            
            window.addEventListener('hashchange', handleUrlHash);
            homeLink.addEventListener('click', () => {
                window.location.hash = '';
            });

            // Modal event listeners
            closeModalButton.addEventListener('click', () => {
                streamingModal.classList.remove('flex');
                streamingModal.classList.add('hidden');
                streamingPlayer.src = ''; // Stop the video
                modalSimilarContainer.innerHTML = ''; // Clear the similar movies when closing the modal
            });
            
            // Add a new event listener to close the modal when clicking outside the content.
            // This checks if the click target is the modal itself.
            streamingModal.addEventListener('click', (e) => {
                if (e.target === streamingModal) {
                    streamingModal.classList.remove('flex');
                    streamingModal.classList.add('hidden');
                    streamingPlayer.src = ''; // Stop the video
                    modalSimilarContainer.innerHTML = ''; // Clear the similar movies when closing the modal
                }
            });

            // Event listener untuk tombol "Stream 1" (vidsrc.me)
            stream1Button.addEventListener('click', () => {
                if (state.currentMediaId) {
                    streamingPlayer.src = `https://vidsrc.me/embed/${state.currentMediaId}`;
                }
            });

            // Event listener untuk tombol "Stream 2" (vidsrc.to)
            stream2Button.addEventListener('click', () => {
                if (state.currentMediaId && state.currentMediaType) {
                    streamingPlayer.src = `https://vidsrc.to/embed/${state.currentMediaType}/${state.currentMediaId}`;
                }
            });
        });
    </script>
</body>
</html>
